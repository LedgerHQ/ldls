import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Components/Search/Implementation" />

# Search Component Implementation

## Installation

Install the packages and their peer dependencies:

```bash
# Install the UI Kit
npm install @ledgerhq/ldls-ui-react @ledgerhq/ldls-design-core

# Install peer dependencies
npm install tailwindcss@^3.4.0 react@^18.3.1 clsx tailwind-merge
```

### Tailwind Configuration

To use the Search component with our custom Tailwind preset, you need to configure your `tailwind.config.ts`:

```typescript
import type { Config } from 'tailwindcss';
import { ledgerLivePreset } from '@ledgerhq/ldls-design-core';

const config = {
  content: [
    "./src/**/*.{js,ts,jsx,tsx}", // Your project's files
    "./node_modules/@ledgerhq/ldls-ui-react/dist/lib/**/*.{js,ts,jsx,tsx}" // Ledger UI Kit components
  ],
  presets: [ledgerLivePreset], // the installed tailwind preset
} satisfies Config;

export default config;
```

### Basic Usage

```tsx
import { Search } from '@ledgerhq/ldls-ui-react';

function MyComponent() {
  const [query, setQuery] = React.useState('');

  return (
    <Search
      placeholder="Search products"
      value={query}
      onChange={(e) => setQuery(e.target.value)}
    />
  );
}
```

> **Note:** Clear button appears automatically when input has content. Use `hideClearButton` to hide it.

#### **Controlled Search**

```tsx
import { Search } from '@ledgerhq/ldls-ui-react';

function MyComponent() {
  const [query, setQuery] = React.useState('');

  return (
    <Search
      placeholder="Search products"
      value={query}
      onChange={(e) => setQuery(e.target.value)}
    />
  );
}
```

#### **Hiding the Clear Button**

Use `hideClearButton` to prevent the clear button from appearing:

```tsx
import { Search } from '@ledgerhq/ldls-ui-react';

function MyComponent() {
  const [query, setQuery] = React.useState('');

  return (
    <Search
      placeholder="Search"
      value={query}
      onChange={(e) => setQuery(e.target.value)}
      hideClearButton // Clear button will not appear
    />
  );
}
```

#### **Custom Clear Behavior**

```tsx
<Search
  placeholder="Search"
  value={query}
  onChange={(e) => setQuery(e.target.value)}
  onClear={() => {
    // Default clearing happens automatically
    analytics.track('search_cleared');
    // Clear error state if needed
    setError('');
  }}
/>
```

> **Note:** The clear button only clears the input value. Error states must be cleared separately in your `onClear` handler.

#### **With Error State**

```tsx
<Search
  placeholder="Search users"
  value={query}
  onChange={(e) => setQuery(e.target.value)}
  aria-invalid={hasError}
  errorMessage={hasError ? 'Search failed' : undefined}
/>
```

## Best Practices

✅ **Do**

```tsx
// Use controlled components
const [query, setQuery] = useState('');
<Search value={query} onChange={(e) => setQuery(e.target.value)} />

// Provide clear placeholder text
<Search placeholder="Search by name or email" />

// Debounce search operations
const debouncedSearch = useMemo(() => debounce(performSearch, 300), []);

// Use stable callbacks
const handleClear = useCallback(() => analytics.track('search_cleared'), []);
```

❌ **Don't**

```tsx
// Don't use labels with Search
<Search label="Search" placeholder="Search products" />

// Don't search on every keystroke
<Search onChange={(e) => performSearch(e.target.value)} />

// Don't override the built-in icon
<Search prefix={<CustomIcon />} />
```
