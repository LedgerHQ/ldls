import { Meta, Story, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as SearchStories from './Search.stories';
import { Search } from './Search';
import { CustomTabs, Tab } from '../../../../.storybook/CustomTabs';

<Meta title='Components/Search' of={SearchStories} />

# üîç Search

<CustomTabs>
  <Tab label="Overview">

## Introduction

The Search component is a specialized input field designed specifically for search functionality. It features a built-in search icon, placeholder text, and automatic clear button for enhanced user experience. Unlike regular inputs, it uses placeholder text instead of floating labels for better search UX patterns.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=2248-3468&m=dev).

## Anatomy

<Canvas of={SearchStories.Default} />
<Controls of={SearchStories.Default} />

> **Layout:** The Search component takes the full width of its container by default. Use wrapper containers to control the desired width.

### Search Icon

Fixed 20px search icon positioned on the left with muted color styling.

<Canvas of={SearchStories.Empty} />

### Placeholder Text

Uses placeholder text instead of floating labels for better search UX. Styled with `text-muted` color.

### Clear Button

Appears automatically when input has content. Use `hideClearButton` to hide it or `onClear` to extend the default clear behavior.

> **Note:** The clear button only clears the input content/value. It does not clear error states - you must handle error state clearing separately in your component logic.

<Canvas of={SearchStories.WithContent} />

### Disabled State

<Canvas of={SearchStories.Disabled} />

### Error State

Supports `aria-invalid` and `errorMessage` props for error handling with proper ARIA labeling.

<Canvas of={SearchStories.Error} />

## Accessibility

- Semantic HTML with proper ARIA attributes
- Keyboard navigation support (Tab, Enter, Escape)
- Screen reader compatible with accessible labels
- Focus management and error state communication

## Advanced Usage

### Debounced Search

For better performance, especially when dealing with API calls or expensive filtering operations, implement debounced search to delay execution until the user stops typing.

<Canvas of={SearchStories.DebouncedSearch} />

> For developers: Check the console to see that the search operation is debounced. The input updates immediately, but the actual "search" (console.log) only fires after you stop typing for 500ms.

## Usage

Use Search for search functionality and data querying. Use Input for form data collection.

</Tab>
<Tab label="Implementation">

```bash
npm install @ledgerhq/ldls-ui-react
```

> **Note**: `@ledgerhq/ldls-design-core` and other peer dependencies (`react`, `tailwindcss`, `clsx`, etc.) are required. See our [Setup Guide ‚Üí](?path=/docs/getting-started-setup-tailwind--docs#1-tailwind-config) for complete installation and Tailwind configuration.

## Basic Usage

```tsx
import { Search } from '@ledgerhq/ldls-ui-react';

function MyComponent() {
  const [query, setQuery] = React.useState('');

  return (
    <Search
      placeholder='Search products'
      value={query}
      onChange={(e) => setQuery(e.target.value)}
    />
  );
}
```

> **Note:** Clear button appears automatically when input has content. Use `hideClearButton` to hide it.

### Layout & Styling

The Search component takes the **full width** of its parent container by default. You can control the width using `className` (preferred) or wrapper containers:

```tsx
// ‚úÖ Preferred: Direct width control
<Search placeholder="Search..." className="max-w-md" />

// ‚úÖ Responsive width control
<Search placeholder="Search..." className="w-full md:max-w-md" />

// Alternative: Container wrapper
<div className="max-w-md">
  <Search placeholder="Search..." />
</div>

// Full width in form (default behavior)
<form>
  <Search placeholder="Search products..." />
</form>
```

#### **Controlled Search**

```tsx
import { Search } from '@ledgerhq/ldls-ui-react';

function MyComponent() {
  const [query, setQuery] = React.useState('');

  return (
    <Search
      placeholder='Search products'
      value={query}
      onChange={(e) => setQuery(e.target.value)}
    />
  );
}
```

#### **Hiding the Clear Button**

Use `hideClearButton` to prevent the clear button from appearing:

```tsx
import { Search } from '@ledgerhq/ldls-ui-react';

function MyComponent() {
  const [query, setQuery] = React.useState('');

  return (
    <Search
      placeholder='Search'
      value={query}
      onChange={(e) => setQuery(e.target.value)}
      hideClearButton // Clear button will not appear
    />
  );
}
```

#### **Custom Clear Behavior**

```tsx
<Search
  placeholder='Search'
  value={query}
  onChange={(e) => setQuery(e.target.value)}
  onClear={() => {
    // Default clearing happens automatically
    analytics.track('search_cleared');
    // Clear error state if needed
    setError('');
  }}
/>
```

> **Note:** The clear button only clears the input value. Error states must be cleared separately in your `onClear` handler.

#### **With Error State**

```tsx
<Search
  placeholder='Search users'
  value={query}
  onChange={(e) => setQuery(e.target.value)}
  aria-invalid={hasError}
  errorMessage={hasError ? 'Search failed' : undefined}
/>
```

## Best Practices

‚úÖ **Do**

```tsx
// Use controlled components
const [query, setQuery] = useState('');
<Search value={query} onChange={(e) => setQuery(e.target.value)} />

// Use className for layout and width control (preferred)
<Search placeholder="Search..." className="max-w-md" />

// Use className for responsive design
<Search placeholder="Search..." className="w-full md:max-w-lg" />

// Provide clear placeholder text
<Search placeholder="Search by name or email" />

// Debounce search operations
const debouncedSearch = useMemo(() => debounce(performSearch, 300), []);

// Use stable callbacks
const handleClear = useCallback(() => analytics.track('search_cleared'), []);
```

‚ùå **Don't**

```tsx
// Don't use labels with Search
<Search label="Search" placeholder="Search products" />

// Don't search on every keystroke
<Search onChange={(e) => performSearch(e.target.value)} />

// Don't override the built-in icon
<Search prefix={<CustomIcon />} />
```

</Tab>
</CustomTabs>
