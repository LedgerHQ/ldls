import { Canvas, Meta, Controls } from '@storybook/addon-docs/blocks';
import * as AddressInputStories from './AddressInput.stories';
import { CustomTabs, Tab } from '../../../../.storybook/CustomTabs';

<Meta of={AddressInputStories} title='Components/AddressInput' />

# AddressInput

<CustomTabs>
  <Tab label="Overview">

The AddressInput component provides a specialized input field for entering cryptocurrency addresses or ENS names. Built on top of BaseInput, it features a customizable prefix label (defaults to "To:") and context-aware suffix icons.

> **Layout:** The AddressInput component takes the full width of its container by default. You can control the width directly using `containerClassName` or by wrapping in a container.

## Introduction

AddressInput is designed specifically where users need to enter wallet addresses or ENS names. It combines the reliability of BaseInput with domain-specific UX enhancements:

- **Customizable prefix label** - defaults to "To:" but can be overridden via prefix prop
- **Conditional QR code scanner** - Appears only when onQrCodeClick handler is provided, using consistent InteractiveIcon styling
- **Smart clear button** - Appears automatically when content is entered
- **Error handling** - Supports error states and error messages

<Canvas of={AddressInputStories.Default} />

## Properties

<Controls />

## States

### Empty State

Shows the InteractiveIcon QR code scanner when onQrCodeClick is provided, indicating users can scan addresses directly. Without onQrCodeClick, no QR code icon appears.

<Canvas of={AddressInputStories.Empty} />

### With Content

When an address is entered, the QR code icon (if present) is replaced with a clear button for easy content removal.

<Canvas of={AddressInputStories.WithContent} />

### Disabled State

Prevents interaction while maintaining visual consistency.

<Canvas of={AddressInputStories.Disabled} />

### Error State

Displays validation errors with proper ARIA attributes for accessibility.

<Canvas of={AddressInputStories.Error} />

## Clear Button

The clear button automatically appears when content is entered, allowing users to quickly reset the field. The QR code scanner icon (if onQrCodeClick is provided) returns when the field becomes empty.

> **Note:** The clear button only clears the input content/value. It does not clear error states - you must handle error state clearing separately in your component logic.

## Without QR Code Scanner

When onQrCodeClick is not provided, no QR code icon appears.

<Canvas of={AddressInputStories.WithoutQrCode} />

## Accessibility

- **ARIA Labels**: Proper labeling for screen readers
- **Error States**: Full ARIA support for validation messages
- **Keyboard Navigation**: Complete keyboard accessibility
- **Focus Management**: Clear focus indicators and logical tab order

</Tab>
<Tab label="Implementation">

# AddressInput Implementation

Technical implementation guide for the AddressInput component.

## Architecture

AddressInput extends BaseInput with Web3-specific functionality:

```tsx
import { AddressInput } from '@ledgerhq/ldls-ui-react';

// Basic usage
<AddressInput
  placeholder="Enter address or ENS"
  value={address}
  onChange={(e) => setAddress(e.target.value)}
/>
```

## Key Features

### Customizable Prefix

The component displays "To:" as the default prefix text, but this can be customized via the `prefix` prop for different use cases.

```tsx
// Default "To:" prefix
<AddressInput placeholder="Enter address or ENS" />

// Custom "From:" prefix for sender address input
<AddressInput
  prefix="From:"
  placeholder="Enter address or ENS"
/>

// Custom prefix for other contexts
<AddressInput
  prefix="Withdraw to:"
  placeholder="Enter withdrawal address"
/>

// Short prefix
<AddressInput
  prefix=">"
  placeholder="Enter destination"
/>
```

### Context-Aware Suffix Icons

- **Empty state**: Shows InteractiveIcon QR code scanner only if onQrCodeClick handler is provided
- **With content**: Shows clear button for quick content removal
- **No handler**: No suffix icon appears if onQrCodeClick is not provided

```tsx
// QR code scanner appears when onQrCodeClick is provided
<AddressInput
  placeholder="Enter address or ENS"
  onQrCodeClick={() => openQrScanner()}
/>

// No QR code scanner when onQrCodeClick is not provided
<AddressInput
  placeholder="Enter address or ENS"
/>

// Clear button appears automatically when there's content (regardless of QR code)
<AddressInput defaultValue="0x742d35cc..." onQrCodeClick={() => openQrScanner()} />
```

### Address Validation

Implement custom validation for different address formats:

```tsx
const [address, setAddress] = React.useState('');
const [error, setError] = React.useState('');

React.useEffect(() => {
  if (address.length > 0) {
    const isValidEthereumAddress = address.startsWith('0x') && address.length === 42;
    const isValidENS = address.endsWith('.eth');

    if (!isValidEthereumAddress && !isValidENS) {
      setError('Please enter a valid Ethereum address or ENS name');
    } else {
      setError('');
    }
  }
}, [address]);

<AddressInput
  value={address}
  onChange={(e) => setAddress(e.target.value)}
  errorMessage={error}
  aria-invalid={!!error}
/>
```

### Custom Clear Behavior

Handle clearing logic with additional state management:

```tsx
<AddressInput
  value={walletAddress}
  onChange={(e) => setWalletAddress(e.target.value)}
  onClear={() => {
    // BaseInput already handles clearing the input value
    setError(''); // Clear error state
    analytics.track('address_cleared');
  }}
/>
```

> **Note:** The clear button only clears the input value. Error states must be cleared separately in your `onClear` handler.

### Layout & Styling

The AddressInput component takes the **full width** of its parent container by default. You can control the width using `containerClassName` (preferred) or wrapper containers:

```tsx
// ✅ Preferred: Direct width control
<AddressInput placeholder="Enter address or ENS" containerClassName="max-w-md" />

// ✅ Responsive width control
<AddressInput placeholder="Enter address or ENS" containerClassName="w-full md:max-w-md" />

// Alternative: Container wrapper
<div className="max-w-md">
  <AddressInput placeholder="Enter address or ENS" />
</div>

// Full width in form (default behavior)
<form>
  <AddressInput placeholder="Enter address or ENS" />
</form>
```

### QR Code Integration

```tsx
const handleQrScan = () => {
  // Open QR scanner modal/camera
  openQrScanner()
    .then((scannedAddress) => {
      setAddress(scannedAddress);
      validateAddress(scannedAddress);
    })
    .catch((error) => {
      console.error('QR scan failed:', error);
    });
};

<AddressInput
  placeholder="Enter address or ENS"
  value={address}
  onChange={(e) => setAddress(e.target.value)}
  onQrCodeClick={handleQrScan}
/>
```

## Common Patterns

### Transaction Forms

```tsx
<form>
  <AddressInput
    placeholder="Enter address or ENS"
    value={recipientAddress}
    onChange={(e) => setRecipientAddress(e.target.value)}
    errorMessage={addressError}
    aria-invalid={!!addressError}
    containerClassName="max-w-md"
  />
  {/* Other transaction fields */}
</form>
```

### Address Book Integration

```tsx
<AddressInput
  placeholder="Enter address or ENS"
  value={selectedAddress}
  onChange={(e) => setSelectedAddress(e.target.value)}
  onQrCodeClick={() => openQrScanner()}
  suffix={
    selectedAddress ? (
      <InteractiveIcon
        iconType="stroked"
        onClick={openAddressBook}
        aria-label="Open address book"
      >
        <ContactsIcon size={20} />
      </InteractiveIcon>
    ) : undefined
  }
/>
```

## Performance Considerations

- Debounce validation for real-time address checking
- Use React.memo for expensive validation computations
- Consider lazy loading for ENS resolution

## Testing

The component includes comprehensive test coverage for:

- **Prefix rendering**: Default "To:" text or custom prefix string
- **InteractiveIcon QR code**: Proper InteractiveIcon integration with accessibility
- **Icon switching**: QR code ↔ clear button based on content
- **Validation states**: Error messages and ARIA attributes
- **Interaction handling**: onChange, onClear, onQrCodeClick, focus states

## Best Practices

✅ **Do**

```tsx
// Use containerClassName for layout and width control (preferred)
<AddressInput placeholder="Enter address or ENS" containerClassName="max-w-md" />

// Use containerClassName for responsive design
<AddressInput placeholder="Enter address or ENS" containerClassName="w-full md:max-w-lg" />

// Use custom prefix for different contexts
<AddressInput
  prefix="From:"
  placeholder="Enter sender address"
/>

// Implement proper validation for address formats
const validateAddress = (address) => {
  const isEthereumAddress = address.startsWith('0x') && address.length === 42;
  const isENS = address.endsWith('.eth');
  return isEthereumAddress || isENS;
};
```

❌ **Don't**

```tsx
// Don't use generic wrapper divs when containerClassName is available
<div className="max-w-md">
  <AddressInput placeholder="Enter address or ENS" />
</div>

// Don't disable QR code functionality without good reason
<AddressInput onQrCodeClick={undefined} />

// Don't use overly long prefix text that affects readability
<AddressInput prefix="This is a very long prefix that takes up too much space:" />
```

</Tab>
</CustomTabs>
