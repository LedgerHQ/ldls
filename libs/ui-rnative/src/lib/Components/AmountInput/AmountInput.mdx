import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as AmountInputStories from './AmountInput.stories';
import { AmountInput } from './AmountInput';
import { CustomTabs, Tab } from '../../../../.storybook/CustomTabs';
import {
  DoVsDontRow,
  DoBlockItem,
  DontBlockItem,
} from '../../../../.storybook/DoVsDont';
import CommonRulesDoAndDont from '../../../../.storybook/DoVsDont/CommonRulesDoAndDont.mdx';

<Meta title='Input/AmountInput' of={AmountInputStories} />

# ðŸ’° AmountInput

<CustomTabs>
  <Tab label="Overview">

## Introduction

AmountInput is a specialized input component designed for handling numeric values with currency display. It features configurable currency text positioning, custom animations, and proper numeric input handling optimized for mobile platforms.

**âš ï¸ Important: AmountInput is a controlled component only.** Both `value` and `onChangeText` props are required.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=6245-2067&m=dev).

<Canvas of={AmountInputStories.WebPreviewWarning} />

## Anatomy

> **Layout:** The AmountInput component takes the full width of its container by default. You can control the width using `className` or by wrapping in a container.

### Currency Text Position

The currency text can be positioned on either the **left** (default) or **right** side of the input:

### Input Validation

The AmountInput provides built-in validation controls:

#### **Integer Only**

`allowDecimals` is set to `true` by default, the input accepts decimal values.
Set it to `false` to only accept whole numbers.

#### **Length Limits**

By default, the AmountInput allows:

- Up to **9 digits** for the integer part (before decimal)
- Up to **9 digits** for the decimal part (after decimal)
- **18 total digits** maximum

You can customize these limits using `maxIntegerLength` and `maxDecimalLength` props if needed.

#### **Thousands Separator**

By default, the component displays thousands separators (e.g., `1 000` for `1000`). You can disable this by setting `thousandsSeparator={false}`.

### Error State

The input supports error handling through `isInvalid` prop which controls the error state styling including text color changes for both input and currency text.

### Disabled State

The component supports disabled state through the `editable` prop set to `false` with appropriate visual feedback.

## Animations

The AmountInput features several sophisticated animations:

### Dynamic Font Sizing

The input automatically adjusts its font size based on the length of the input value, ensuring large numbers remain visible and readable.

### Custom Caret

A custom animated caret provides smooth blinking animation that feels native to mobile platforms.

### Text Entry Animation

When text changes, subtle slide animations provide visual feedback for a more engaging user experience.

## Accessibility

The AmountInput component follows accessibility best practices:

- Supports screen reader navigation
- Proper keyboard type (decimal pad) for numeric input
- Touch target sizes meet minimum requirements
- Error states are visually distinct

## Best Practices

**Currency Position**: Place currency symbols on the left for most Western currencies (USD, EUR), and on the right for specific formats (e.g., "100 USD")

**Validation**: Use `isInvalid` to indicate errors without blocking user input

**Length Limits**: Set appropriate `maxIntegerLength` and `maxDecimalLength` based on your use case

**Thousands Separator**: Keep enabled (default) for better readability of large amounts

</Tab>
<Tab label="Implementation">

## Setup

Install and set up the library with our [Setup Guide â†’](?path=/docs/getting-started-setup--docs).

### Basic Usage

```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

function MyComponent() {
  const [value, setValue] = useState('');

  return (
    <AmountInput
      value={value}
      onChangeText={setValue}
      currencyText='USD'
      allowDecimals={true} // Allow decimal points
    />
  );
}
```

> **Note**: AmountInput is a **controlled component only**. You must provide both `value` and `onChangeText` props.

### Input Validation

The AmountInput component provides multiple ways to control input validation:

```tsx
// Integer-only input limited to 8 digits
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="$"
  maxIntegerLength={8}
  maxDecimalLength={0} // Integer only
  allowDecimals={false}
/>

// Short input with custom length (useful for codes or small amounts)
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="$"
  maxIntegerLength={3} // Only allow 3 digits
  maxDecimalLength={0} // Integer only
  allowDecimals={false}
/>

// Large number input with decimal support
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="USD"
  maxIntegerLength={12} // Allow larger integer amounts
  maxDecimalLength={8} // Allow up to 8 decimal places
  allowDecimals={true}
/>
```

### With Currency Position

The currency text can be positioned on either side of the input:

```tsx
// Left position (default)
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="USD"
  currencyPosition="left"
/>

// Right position
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="USD"
  currencyPosition="right"
/>
```

### With Thousands Separator

Control whether thousands separators are displayed:

```tsx
// With separator (default) - displays as "1 000"
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="USD"
  thousandsSeparator={true}
/>

// Without separator - displays as "1000"
<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText="USD"
  thousandsSeparator={false}
/>
```

### With Error State

The AmountInput component supports error states through the `isInvalid` prop:

```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

function MyComponent() {
  const [value, setValue] = useState('');
  const [error, setError] = useState(false);

  const handleChange = (text: string) => {
    setValue(text);
    // Example validation: ensure it's a valid number
    setError(text === '' || isNaN(parseFloat(text)));
  };

  return (
    <AmountInput
      value={value}
      onChangeText={handleChange}
      currencyText='USD'
      isInvalid={error}
    />
  );
}
```

### Disabled State

Use the `editable` prop to disable the input:

```tsx
<AmountInput value='1000' currencyText='USD' editable={false} />
```

## Do's and Don'ts

<div className='flex flex-col gap-24'>
  <DoVsDontRow>
    <DoBlockItem
      title='Use integer-only for whole number scenarios'
      description='Disable decimals for quantities, counts, or other whole number inputs'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

const [quantity, setQuantity] = useState('');

// Use integer-only for whole number scenarios (quantity, age, etc.)
<AmountInput
  value={quantity}
  onChangeText={setQuantity}
  currencyText='items'
  allowDecimals={false}
  maxIntegerLength={4}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't allow decimals for count-based inputs"
      description='Items, quantities, and counts should always be whole numbers'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

const [quantity, setQuantity] = useState('');

<AmountInput
  value={quantity}
  onChangeText={setQuantity}
  currencyText='items'
  allowDecimals={true}
  maxIntegerLength={4}
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Always use controlled input pattern'
      description='AmountInput requires both value and onChangeText props'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

const [value, setValue] = useState('');

<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText='USD'
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't use uncontrolled pattern"
      description='AmountInput does not support defaultValue - always use controlled pattern'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

const [value, setValue] = useState('');

<AmountInput
  defaultValue='0.00'
  currencyText='USD'
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Use isInvalid for error states'
      description='Use the isInvalid prop to indicate validation errors'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

const [value, setValue] = useState('');
const [hasError, setHasError] = useState(false);

<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText='USD'
  isInvalid={hasError}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't use custom error props"
      description='Use isInvalid prop, not error or errorMessage props'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';
import { useState } from 'react';

const [value, setValue] = useState('');
const [hasError, setHasError] = useState(false);

<AmountInput
  value={value}
  onChangeText={setValue}
  currencyText='USD'
  error={true}
  errorMessage='Invalid amount'
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Use appropriate length limits'
      description='Set maxIntegerLength and maxDecimalLength based on your use case'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';

<AmountInput
  value={amount}
  onChangeText={setAmount}
  currencyText='$'
  maxIntegerLength={9}
  maxDecimalLength={2}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't use overly restrictive or excessive limits"
      description='Length limits should match real-world requirements'
    >

{/* prettier-ignore */}
```tsx
import { AmountInput } from '@ledgerhq/ldls-ui-rnative';

<AmountInput
  value={amount}
  onChangeText={setAmount}
  currencyText='$'
  maxIntegerLength={1}
  maxDecimalLength={25}
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <CommonRulesDoAndDont />
</div>

## Platform Considerations

### iOS Specific

- Input automatically uses iOS decimal pad keyboard
- Respects iOS accessibility settings like Dynamic Type
- Custom caret animation aligns with iOS design language
- Keyboard automatically handles safe area insets

### Android Specific

- Supports Android decimal keyboard input methods
- Handles Android back button interactions appropriately
- Respects Android accessibility services
- Custom animations work seamlessly on Android

### Cross-Platform

- Consistent visual appearance across platforms
- Platform-appropriate keyboard behavior (decimal pad)
- Unified API regardless of platform
- Smooth animations powered by react-native-reanimated work on both platforms
- Dynamic font sizing ensures readability on all screen sizes

</Tab>
</CustomTabs>
