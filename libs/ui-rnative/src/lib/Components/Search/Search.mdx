import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as SearchStories from './Search.stories';
import { Search } from './Search';
import { CustomTabs, Tab } from '../../../../.storybook/components';
import { DoVsDontRow, DoBlockItem, DontBlockItem } from '../../../../.storybook/components/DoVsDont';
import CommonRulesDoAndDont from '../../../../.storybook/components/DoVsDont/CommonRulesDoAndDont.mdx';

<Meta title='Input/Search' of={SearchStories} />

# üîç Search

<CustomTabs>
  <Tab label="Overview">

## Introduction

The Search component is a specialized input field designed specifically for search functionality on mobile platforms. It features a built-in search icon, placeholder text, and automatic clear button for enhanced user experience. Unlike regular inputs, it uses placeholder text instead of floating labels for better search UX patterns.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=2248-3468&m=dev).

> ‚ö†Ô∏è **Note on Web Preview:** The Storybook preview below may display visual inconsistencies as certain React Native APIs (such as Reanimated animations) cannot be fully translated to web environments. While the component's functionality should accurately represent the native implementation, it may not render as intended. For the complete native experience, please refer to the component on an actual iOS or Android device.

<Canvas of={SearchStories.Base} />
<Controls of={SearchStories.Base} />

## Anatomy

> **Layout:** The Search component takes the full width of its container by default. You can control the width by using the `style` prop or by wrapping in a container.

### Search Icon

Fixed 20px search icon positioned on the left with muted color styling. The icon is built-in and cannot be customized.

### Placeholder Text

Uses placeholder text instead of floating labels for better search UX. Styled with `text-muted` color.

### Clear Button

A clear button (√ó) appears **automatically** when input has content.

<Canvas of={SearchStories.WithContent} />

> **Note:** The clear button only clears the input content/value. It does not clear error states - you must handle error state clearing separately in your component logic.

#### **Hiding the Clear Button**

Use `hideClearButton` to prevent the clear button from appearing.

<Canvas of={SearchStories.WithHiddenClearButton} />

#### **Extending the Clear Behavior**

Use `onClear` to extend the default clear behavior with custom logic.

<Canvas of={SearchStories.WithClearCallback} />

### Disabled State

The search input can be disabled using the `editable` prop set to `false`.

<Canvas of={SearchStories.DisabledSearch} />

### Error State

The search component supports error handling through `errorMessage` which displays an error message below the input with error styling including a red border and text color.

<Canvas of={SearchStories.WithError} />

The error message will be automatically:

- Connected to the input
- Displayed with a warning icon
- Styled in the error color
- Announced by screen readers

## Controlled vs Uncontrolled

The Search component supports both controlled and uncontrolled usage.

### Uncontrolled (with defaultValue)

Use defaultValue when you don't need to track the search query in state. The component manages its own internal state.

### Controlled (with value and onChangeText)

Use `value` and `onChangeText` when you want full control of the search query from your component logic. This is the recommended approach for search functionality.

## Keyboard Types

The component supports various React Native TextInput keyboard types. While the default keyboard is suitable for most search scenarios, you can customize it:

- default (text) - recommended for most searches
- email-address - for email search
- url - for URL search
- numeric - for numeric search

Set these using the `keyboardType` prop.

## Accessibility

The Search component follows accessibility best practices:

- Supports screen reader navigation
- Placeholder text is properly announced
- Error messages are properly announced
- Clear button has an accessible label
- Search icon is marked as decorative (`accessible={false}`)
- Touch target sizes meet minimum requirements (48px height)

## Best Practices

**Placeholder Text**: Provide clear, descriptive placeholder text that indicates what can be searched

**Error Messages**: Make error messages helpful and actionable (e.g., "Search failed. Please try again")

**Debouncing**: Debounce search operations to avoid excessive API calls or filtering on every keystroke

**Clear Button**: Automatically available - use for quick clearing of search queries

**Keyboard Types**: Use the default keyboard type unless you have a specific use case

**Performance**: For large datasets or API searches, implement proper debouncing and optimize your search logic

</Tab>
<Tab label="Implementation">

## Setup

Install and set up the library with our [Setup Guide ‚Üí](?path=/docs/getting-started-setup--docs).

### Basic Usage

```tsx
import { Search } from '@ledgerhq/lumen-ui-rnative';
import { useState } from 'react';

function MyComponent() {
  const [query, setQuery] = useState('');

  return (
    <Search
      placeholder='Search products'
      value={query}
      onChangeText={setQuery}
    />
  );
}
```

> **Note:** Clear button appears automatically when input has content. Use `hideClearButton` to hide it.

#### **Hiding the Clear Button**

Use `hideClearButton` to prevent the clear button from appearing:

```tsx
import { Search } from '@ledgerhq/lumen-ui-rnative';
import { useState } from 'react';

function MyComponent() {
  const [query, setQuery] = useState('');

  return (
    <Search
      placeholder='Search'
      value={query}
      onChangeText={setQuery}
      hideClearButton // Clear button will not appear
    />
  );
}
```

#### **Extending the Clear Behavior**

Provide `onClear` to extend the default clear behavior with additional logic:

```tsx
import { Search } from '@ledgerhq/lumen-ui-rnative';
import { useState } from 'react';

function MyComponent() {
  const [query, setQuery] = useState('');
  const [error, setError] = useState('');

  return (
    <Search
      placeholder='Search users'
      value={query}
      onChangeText={setQuery}
      onClear={() => {
        // Default clearing happens automatically
        // Add your custom logic here
        analytics.track('search_cleared');
        // Clear error state if needed
        setError('');
      }}
    />
  );
}
```

### With Error State

The Search component supports error states and messages:

```tsx
import { Search } from '@ledgerhq/lumen-ui-rnative';
import { useState } from 'react';

function MyComponent() {
  const [query, setQuery] = useState('');
  const [error, setError] = useState('');

  const handleSearch = (text: string) => {
    setQuery(text);
    // Example: validate search query
    if (text.length > 0 && text.length < 2) {
      setError('Search query must be at least 2 characters');
    } else {
      setError('');
    }
  };

  return (
    <Search
      placeholder='Search products'
      value={query}
      onChangeText={handleSearch}
      errorMessage={error}
    />
  );
}
```

> **Note:** Error messages are optional. Use `errorMessage` to display an error message below the search input.

### With Custom Styling

While the component comes with predefined styles, you can extend them using the `style` prop:

```tsx
<Search
  placeholder='Search'
  value={query}
  onChangeText={setQuery}
  style={{ maxWidth: 320 }} // Control width
/>
```

### With Different Keyboard Types

Use the `keyboardType` prop to show the appropriate keyboard:

```tsx
// Email search keyboard
<Search
  placeholder='Search by email'
  value={query}
  onChangeText={setQuery}
  keyboardType='email-address'
/>

// URL search keyboard
<Search
  placeholder='Search by URL'
  value={query}
  onChangeText={setQuery}
  keyboardType='url'
/>
```

### Disabled State

Use the `editable` prop to disable the search input:

```tsx
<Search placeholder='Search' value='Current search' editable={false} />
```

### Debounced Search Example

For better performance, especially when dealing with API calls or expensive filtering operations, implement debounced search:

```tsx
import { Search } from '@ledgerhq/lumen-ui-rnative';
import { useState, useCallback } from 'react';
import { debounce } from 'lodash'; // or your preferred debounce utility

function MyComponent() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);

  // Debounced search function
  const performSearch = useCallback(
    debounce(async (searchQuery: string) => {
      if (searchQuery.trim()) {
        const results = await searchAPI(searchQuery);
        setResults(results);
      } else {
        setResults([]);
      }
    }, 500),
    [],
  );

  const handleChange = (text: string) => {
    setQuery(text); // Update immediately for UI responsiveness
    performSearch(text); // Debounced search operation
  };

  return (
    <Search
      placeholder='Search products'
      value={query}
      onChangeText={handleChange}
    />
  );
}
```

## Do's and Don'ts

The following guidelines ensure consistent usage of the Search component and maintain design system principles.

<div style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>
  <DoVsDontRow>
    <DoBlockItem
      title='Use placeholder text'
      description='Search uses placeholder text instead of labels for optimal search UX'
    >

{/* prettier-ignore */}
```tsx
<Search
  placeholder='Search by name or email'
  value={query}
  onChangeText={setQuery}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't use label prop"
      description='Search component does not support labels as they are not suitable for search UX patterns'
    >

{/* prettier-ignore */}
```tsx
<Search
  label='Search' // Not supported, will cause error
  placeholder='Search by name or email'
  value={query}
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Use the built-in search icon'
      description='The search icon is automatically included and cannot be changed'
    >

{/* prettier-ignore */}
```tsx
<Search
  placeholder='Search products'
  value={query}
  onChangeText={handleChange}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't override the search icon"
      description='The prefix prop is not available on Search component'
    >

{/* prettier-ignore */}
```tsx
<Search
  prefix={<CustomIcon />} // Not supported, will cause error
  placeholder='Search products'
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Use onClear for custom logic only'
      description='Let the component handle clearing automatically, add onClear only for additional logic'
    >

{/* prettier-ignore */}
```tsx
<Search
  placeholder='Search'
  value={query}
  onChangeText={setQuery}
  onClear={() => {
    // Default clearing happens automatically
    analytics.track('search_cleared');
  }}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't manually clear in onClear"
      description='Value clearing happens automatically - no need to call setQuery'
    >

{/* prettier-ignore */}
```tsx
<Search
  placeholder='Search'
  value={query}
  onChangeText={setQuery}
  onClear={() => setQuery('')}
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Debounce expensive search operations'
      description='Use debouncing for API calls or expensive filtering to improve performance'
    >

{/* prettier-ignore */}
```tsx
const debouncedSearch = useCallback(
  debounce((text: string) => performSearch(text), 500),
  []
);

<Search
  placeholder='Search'
  value={query}
  onChangeText={(text) => {
    setQuery(text);
    debouncedSearch(text);
  }}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't perform expensive operations on every keystroke"
      description='Avoid running expensive operations on every input change without debouncing'
    >

{/* prettier-ignore */}
```tsx
const debouncedSearch = useCallback(
  debounce((text: string) => performSearch(text), 500),
  []
);

<Search
  placeholder='Search'
  value={query}
  onChangeText={(text) => {
    setQuery(text);
    performExpensiveAPICall(text); // Should be debounced
  }}
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <DoVsDontRow>
    <DoBlockItem
      title='Provide descriptive placeholder text'
      description='Use clear, specific placeholder text that describes what users can search for'
    >

{/* prettier-ignore */}
```tsx
<Search
  placeholder='Search by name or email'
  value={query}
  onChangeText={setQuery}
/>
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't use vague placeholder text"
      description='Avoid generic or unclear placeholder text that does not help users'
    >

{/* prettier-ignore */}
```tsx
<Search
  placeholder='Type here'
  value={query}
  onChangeText={setQuery}
/>
```

    </DontBlockItem>

  </DoVsDontRow>

  <CommonRulesDoAndDont />
</div>

## Platform Considerations

### iOS Specific

- Search input automatically adapts to iOS design guidelines
- Keyboard automatically handles safe area insets
- Respects iOS accessibility settings like Dynamic Type
- Search icon renders with platform-appropriate styling

### Android Specific

- Supports Android keyboard types and input methods
- Handles Android back button interactions appropriately
- Respects Android accessibility services
- Search icon adapts to Android visual guidelines

### Cross-Platform

- Consistent visual appearance across platforms
- Platform-appropriate keyboard behavior
- Unified API regardless of platform
- Search icon maintains consistent 20px size
- Clear button behavior works seamlessly on both platforms

## Usage Guidelines

Use Search for:

- Search functionality and data querying
- Filtering lists or datasets
- Quick find operations
- Search bars in navigation

Use TextInput (instead of Search) for:

- Form data collection
- User profile information
- Settings and configurations
- Any input that requires a label

</Tab>
</CustomTabs>
