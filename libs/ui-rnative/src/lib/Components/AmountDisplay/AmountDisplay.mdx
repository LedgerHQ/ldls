import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as AmountDisplayStories from './AmountDisplay.stories';
import { AmountDisplay } from './AmountDisplay';
import {
  CustomTabs,
  Tab,
  DoVsDontRow,
  DoBlockItem,
  DontBlockItem,
} from '../../../../.storybook/components';
import CommonRulesDoAndDont from '../../../../.storybook/components/DoVsDont/CommonRulesDoAndDont.mdx';

<Meta title='Communication/AmountDisplay' of={AmountDisplayStories} />

# ðŸ”¢ AmountDisplay

<CustomTabs>
  <Tab label="Overview">

## Introduction

The AmountDisplay component renders formatted monetary amounts with flexible currency positioning and decimal formatting. It uses a formatter function pattern that gives you full control over how amounts are displayed.

> View in [Figma](https://www.figma.com/design/JxaLVMTWirCpU0rsbZ30k7/2.-Components-Library?node-id=85-227&p=f&m=dev).

## Anatomy

<Canvas of={AmountDisplayStories.Base} />

- **Integer Part**: Large, bold text for the main amount
- **Decimal Part**: Smaller, muted text for fractional values
- **Currency Symbol**: Positioned before or after based on formatter
- **Decimal Separator**: Configurable (either `.` or `,`)

## Properties

### Overview

<Canvas of={AmountDisplayStories.Base} />
<Controls of={AmountDisplayStories.Base} />

### Flexible Formatting

The formatter function gives you complete control over how amounts are displayed. You can customize currency position, decimal separators, precision, and even implement privacy features like hiding amounts.

<Canvas of={AmountDisplayStories.WithHideButton} />

The example above shows how the formatter pattern enables features like toggling amount visibility. By changing the formatter function, you can switch between displaying the actual amount and showing masked characters - perfect for privacy-sensitive applications.

## Accessibility

- Uses semantic components for proper screen reader support
- Maintains readable text contrast ratios
- Works with text zoom up to 200%

</Tab>
<Tab label="Implementation">

## Installation

```bash
npm install @ledgerhq/lumen-ui-rnative
```

> **Note**: `@ledgerhq/lumen-design-core` and other peer dependencies (`react`, `react-native`, etc.) are required. See our Setup Guide for complete installation.

## Basic Usage

```tsx
import { AmountDisplay } from '@ledgerhq/lumen-ui-rnative';
import type { FormattedValue } from '@ledgerhq/lumen-ui-rnative';

// Create a formatter function
const usdFormatter = (value: number): FormattedValue => {
  const [integerPart, decimalPart] = value.toFixed(2).split('.');
  
  return {
    integerPart,
    decimalPart,
    currencyText: '$',
    decimalSeparator: '.',
    currencyPosition: 'start',
  };
};

function MyComponent() {
  return <AmountDisplay value={1234.56} formatter={usdFormatter} />;
}
```

## Custom Formatters

### EUR with Comma Separator

```tsx
const eurFormatter = (value: number): FormattedValue => {
  const [integerPart, decimalPart] = value.toFixed(2).split('.');
  
  return {
    integerPart,
    decimalPart,
    currencyText: 'â‚¬',
    decimalSeparator: ',',
    currencyPosition: 'end',
  };
};

<AmountDisplay value={999.99} formatter={eurFormatter} />
// Displays: 999,99 â‚¬
```

### Cryptocurrency with Variable Precision

```tsx
const btcFormatter = (value: number): FormattedValue => {
  const [integerPart, decimalPart] = value.toFixed(8).split('.');
  
  return {
    integerPart,
    decimalPart,
    currencyText: 'BTC',
    decimalSeparator: '.',
    currencyPosition: 'end',
  };
};

<AmountDisplay value={0.00123456} formatter={btcFormatter} />
// Displays: 0.00123456 BTC
```

### Hidden Amount for Privacy

```tsx
import { AmountDisplay } from '@ledgerhq/lumen-ui-rnative';
import { IconButton } from '@ledgerhq/lumen-ui-rnative';
import { Eye, EyeCross } from '@ledgerhq/lumen-ui-rnative';
import { useState } from 'react';
import { View } from 'react-native';

function PrivateAmount() {
  const [hidden, setHidden] = useState(false);
  
  const hiddenFormatter = (): FormattedValue => ({
    integerPart: 'â€¢â€¢â€¢â€¢',
    currencyText: '$',
    currencyPosition: 'start',
  });
  
  const usdFormatter = (value: number): FormattedValue => {
    const [integerPart, decimalPart] = value.toFixed(2).split('.');
    return {
      integerPart,
      decimalPart,
      currencyText: '$',
      decimalSeparator: '.',
      currencyPosition: 'start',
    };
  };
  
  return (
    <View style={{ flexDirection: 'row', alignItems: 'center', gap: 12 }}>
      <AmountDisplay
        formatter={hidden ? hiddenFormatter : usdFormatter}
        value={1234.56}
      />
      <IconButton
        appearance='transparent'
        size='sm'
        icon={hidden ? EyeCross : Eye}
        aria-label={hidden ? 'Show amount' : 'Hide amount'}
        onPress={() => setHidden(!hidden)}
      />
    </View>
  );
}
```

## Do's and Don'ts

<div className='flex flex-col gap-24'>
  <DoVsDontRow>
    <DoBlockItem
      title='Use formatter for all display logic'
      description='Keep all formatting logic in the formatter function'
    >

{/* prettier-ignore */}
```tsx
const formatter = (value: number): FormattedValue => {
  const [integerPart, decimalPart] = value.toFixed(2).split('.');
  return {
    integerPart,
    decimalPart,
    currencyText: '$',
    decimalSeparator: '.',
    currencyPosition: 'start',
  };
};

<AmountDisplay value={1234.56} formatter={formatter} />
```

    </DoBlockItem>
    <DontBlockItem
      title="Don't format the value outside the component"
      description='Pass the raw number value, not a pre-formatted string'
    >

{/* prettier-ignore */}
```tsx
const formattedValue = `$${value.toFixed(2)}`;

<AmountDisplay
  value={formattedValue}
  formatter={(v) => ({ integerPart: v, currencyText: '' })}
/>
```

    </DontBlockItem>
  </DoVsDontRow>

  <CommonRulesDoAndDont />
</div>

</Tab>
</CustomTabs>
